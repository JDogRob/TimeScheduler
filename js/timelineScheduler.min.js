/*!  Copyright (c) 2013 Zallist
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:
    The above copyright notice and this permission notice shall be included in
    all copies or substantial portions of the Software.
    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
    THE SOFTWARE.
*/
/*! Project location: https://github.com/Zallist/TimeScheduler */
var TimeScheduler={Options:{GetSections:function(){},GetSchedule:function(){},Start:moment(),HeaderFormat:"Do MMM YYYY",LowerFormat:"DD-MMM-YYYY HH:mm",Periods:[{Name:"2 days",Label:"2 days",TimeframePeriod:120,TimeframeOverall:2880,TimeframeHeaders:["Do MMM","HH"]},{Name:"2 weeks",Label:"2 weeks",TimeframePeriod:1440,TimeframeOverall:20160,TimeframeHeaders:["MMM","Do"]}],SelectedPeriod:"2 weeks",Element:$("<div><\/div>"),MinRowHeight:40,ShowCurrentTime:!0,ShowGoto:!0,ShowToday:!0,Text:{NextButton:"Next",NextButtonTitle:"Next period",PrevButton:"Prev",PrevButtonTitle:"Previous period",TodayButton:"Today",TodayButtonTitle:"Go to today",GotoButton:"Go to",GotoButtonTitle:"Go to specific date"},Events:{ItemMouseEnter:null,ItemMouseLeave:null,ItemClicked:null,ItemDropped:null,ItemResized:null,ItemMovement:null,ItemMovementStart:null,ItemMovementEnd:null,ItemEventClick:null,ItemEventMouseEnter:null,ItemEventMouseLeave:null},AllowDragging:!1,AllowResizing:!1,DisableOnMove:!0,MaxHeight:null},Wrapper:null,HeaderWrap:null,TableWrap:null,SectionWrap:null,Table:null,Sections:{},CachedSectionResult:null,CachedScheduleResult:null,Init:function(n){TimeScheduler.Options.Element.find(".ui-draggable").draggable("destroy"),TimeScheduler.Options.Element.empty(),TimeScheduler.Wrapper=$('<div class="time-sch-wrapper"><\/div>').appendTo(TimeScheduler.Options.Element),TimeScheduler.HeaderWrap=$('<div class="time-sch-header-wrapper time-sch-clearfix"><\/div>').appendTo(TimeScheduler.Wrapper),TimeScheduler.TableWrap=$('<div class="time-sch-table-wrapper"><\/div>').appendTo(TimeScheduler.Wrapper),TimeScheduler.SectionWrap=$('<div class="time-sch-section-wrapper"><\/div>').appendTo(TimeScheduler.TableWrap),TimeScheduler.CreateCalendar(),TimeScheduler.FillSections(n)},GetSelectedPeriod:function(){for(var n,t=0;t<TimeScheduler.Options.Periods.length;t++)if(TimeScheduler.Options.Periods[t].Name===TimeScheduler.Options.SelectedPeriod){n=TimeScheduler.Options.Periods[t];break}return n||(n=TimeScheduler.Options.Periods[0],TimeScheduler.SelectPeriod(n.Name)),n},GetEndOfPeriod:function(n,t){return moment(n).add("minutes",t.TimeframeOverall)},CreateCalendar:function(){var o,h,s,r,u,c,l,a,n,v,f=null,t=0,i,e;for(n=TimeScheduler.GetSelectedPeriod(),v=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,n),l=Math.abs(TimeScheduler.Options.Start.diff(v,"minutes")),a=l/n.TimeframePeriod,TimeScheduler.Table=$('<table class="time-sch-table"><\/table>'),o=$("<thead><\/thead>"),h=$("<tbody><\/tbody>"),i=0;i<n.TimeframeHeaders.length;i++){for(f=null,t=0,c=n.TimeframeHeaders[i],s=$('<tr class="time-sch-times"><\/tr>').addClass("time-sch-times-header-"+i).appendTo(o),r=$('<td class="time-sch-section-header"><\/td>').appendTo(s),e=0;e<a;e++)u=moment(TimeScheduler.Options.Start).add("minutes",e*n.TimeframePeriod).format(c),f!==u&&(f&&(r.attr("colspan",t),t=0),f=u,r=$('<td class="time-sch-date-header"><\/td>').append(u).appendTo(s)),t+=1;r.attr("colspan",t)}TimeScheduler.Table.append(o,h),TimeScheduler.TableWrap.append(TimeScheduler.Table),TimeScheduler.FillHeader()},CreateSections:function(n){var r,i,f,e,u,t;for(r=1,u=$.makeArray(TimeScheduler.Table.find("thead tr")),t=0;t<u.length;t++)r<$(u[t]).find(".time-sch-date-header").length&&(r=$(u[t]).find(".time-sch-date-header").length);for(t=0;t<n.length;t++){for(i=$('<tr class="time-sch-section-row"><\/tr>').css("height",TimeScheduler.Options.MinRowHeight),i.addClass(t%2==0?"time-sch-section-even":"time-sch-section-odd"),f=$('<td class="time-sch-section"><\/td>').text(n[t].name).data("section",n[t]).appendTo(i),time=0;time<r;time++)f=$('<td class="time-sch-date"><\/td>').appendTo(i);e=$('<div class="time-sch-section-container"><\/div>').css("height",TimeScheduler.Options.MinRowHeight).data("section",n[t]).appendTo(TimeScheduler.SectionWrap),TimeScheduler.Sections[n[t].id]={row:i,container:e},TimeScheduler.Table.find("tbody").append(i)}TimeScheduler.SectionWrap.css({top:TimeScheduler.Table.find("thead").height(),left:$(".time-sch-section").outerWidth()}),TimeScheduler.Options.ShowCurrentTime&&TimeScheduler.ShowCurrentTime()},ShowCurrentTimeHandle:null,ShowCurrentTime:function(){var n,t,r,u,i;TimeScheduler.ShowCurrentTimeHandle&&clearTimeout(TimeScheduler.ShowCurrentTimeHandle),n=moment(),i=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,TimeScheduler.GetSelectedPeriod()),r=Math.abs(TimeScheduler.Options.Start.diff(i,"minutes")),u=Math.abs(TimeScheduler.Options.Start.diff(n,"minutes")),t=$(".time-sch-current-time"),t.remove(),n>=TimeScheduler.Options.Start&&n<=i&&(t=$('<div class="time-sch-current-time"><\/div>').css("left",u/r*100+"%").attr("title",n.format(TimeScheduler.Options.LowerFormat)).appendTo(TimeScheduler.SectionWrap)),TimeScheduler.ShowCurrentTimeHandle=setTimeout(TimeScheduler.ShowCurrentTime,3e4)},CreateItems:function(n){var t,e,o,i,g,nt,tt,it,rt,ft,ut,et,ot,st,ht,y,ct,r={},c,u,s,lt,at,l,p,a,v,f,w,b,h,k,d;for(at=TimeScheduler.GetSelectedPeriod(),l=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,at),rt=Math.abs(TimeScheduler.Options.Start.diff(l,"minutes")),f=0;f<n.length;f++)if(t=n[f],o=TimeScheduler.Sections[t.sectionID],o&&(r[t.sectionID]||(r[t.sectionID]=[]),t.start<=l&&t.end>=TimeScheduler.Options.Start)){if(c=null,y=moment(Math.max(t.start,TimeScheduler.Options.Start)),ct=moment(Math.min(t.end,l)),ft=y.diff(TimeScheduler.Options.Start,"minutes"),ut=Math.abs(y.diff(ct,"minutes")),ot=0,st=ft/rt*100,ht=ut/rt*100,i=$('<div class="time-sch-item"><\/div>'),i.css({top:ot,left:st+"%",width:ht+"%"}),it=$('<img alt="Icon" class="time-sch-item-icon" />'),nt=$('<div class="time-sch-item-content"><\/div>'),t.name&&(tt=$('<div class="time-sch-item-name"><\/div>'),tt.html(t.name),nt.append(tt)),t.icon&&(it.attr({src:t.icon}),i.append(it)),i.append(nt),t.classes&&i.addClass(t.classes),t.events)for(p=0;p<t.events.length;p++)e=t.events[p],et=e.at.diff(y,"minutes")/ut*100,g=$('<div class="time-sch-item-event"><\/div>').attr("title",e.at.format(TimeScheduler.Options.LowerFormat)+" - "+e.label).css("left",et+"%").data("event",e),e.classes&&g.addClass(e.classes),i.append(g);for(t.start>=TimeScheduler.Options.Start&&i.append('<div class="time-sch-item-start"><\/div>'),t.end<=l&&i.append('<div class="time-sch-item-end"><\/div>'),t.Element=i,a=0;a<r[t.sectionID].length;a++)if(r[t.sectionID][a].start>t.start){c=a;break}c===null&&(c=r[t.sectionID].length),r[t.sectionID].splice(c,0,t),i.data("item",t),TimeScheduler.SetupItemEvents(i),o.container.append(i)}for(v in r)for(o=TimeScheduler.Sections[v],f=0;f<r[v].length;f++){for(u=r[v][f],w=0;w<f;w++)s=r[v][w],k=s.Element.position().top,d=k+s.Element.outerHeight(),b=u.Element.position().top,h=b+u.Element.outerHeight(),lt=(s.start<=u.start&&u.start<=s.end||s.start<=u.end&&u.end<=s.end)&&(k<=b&&b<=d||k<=h&&h<=d),lt&&u.Element.css("top",d+1);h=u.Element.position().top+u.Element.outerHeight()+1,h>o.container.height()&&(o.container.css("height",h),o.row.css("height",h))}},SetupItemEvents:function(n){if(TimeScheduler.Options.Events.ItemClicked&&n.click(function(n){n.preventDefault(),TimeScheduler.Options.Events.ItemClicked.call(this,$(this).data("item"))}),TimeScheduler.Options.Events.ItemMouseEnter&&n.mouseenter(function(){TimeScheduler.Options.Events.ItemMouseEnter.call(this,$(this).data("item"))}),TimeScheduler.Options.Events.ItemMouseLeave&&n.mouseleave(function(){TimeScheduler.Options.Events.ItemMouseLeave.call(this,$(this).data("item"))}),TimeScheduler.Options.AllowDragging&&(n.draggable({helper:"clone",zIndex:1,appendTo:".time-sch-section-wrapper",distance:5,snap:".time-sch-section-container",snapMode:"inner",snapTolerance:10,drag:function(n,t){var i,r,u,f,e,o;TimeScheduler.Options.Events.ItemMovement&&(f=TimeScheduler.GetSelectedPeriod(),e=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,f),o=Math.abs(TimeScheduler.Options.Start.diff(e,"minutes")),i=$(n.target).data("item"),r=moment(TimeScheduler.Options.Start).add("minutes",o*(t.helper.position().left/TimeScheduler.SectionWrap.width())),u=moment(r).add("minutes",Math.abs(i.start.diff(i.end,"minutes"))),i.start<TimeScheduler.Options.Start&&(r.add("minutes",i.start.diff(TimeScheduler.Options.Start,"minutes")),u.add("minutes",i.start.diff(TimeScheduler.Options.Start,"minutes"))),TimeScheduler.Options.Events.ItemMovement.call(this,i,r,u))},start:function(n,t){$(this).hide(),t.helper.children().not(".time-sch-item-content").remove(),TimeScheduler.Options.Events.ItemMovementStart&&TimeScheduler.Options.Events.ItemMovementStart.call(this)},stop:function(){$(this).length&&$(this).show(),TimeScheduler.Options.Events.ItemMovementEnd&&TimeScheduler.Options.Events.ItemMovementEnd.call(this)},cancel:".time-sch-item-end, .time-sch-item-start, .time-sch-item-event"}),$(".time-sch-section-container").droppable({greedy:!0,hoverClass:"time-sch-droppable-hover",tolerance:"pointer",drop:function(n,t){var i,f,r,u,e,o,s;e=TimeScheduler.GetSelectedPeriod(),o=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,e),s=Math.abs(TimeScheduler.Options.Start.diff(o,"minutes")),i=t.draggable.data("item"),f=$(this).data("section").id,r=moment(TimeScheduler.Options.Start).add("minutes",s*(t.helper.position().left/$(this).width())),u=moment(r).add("minutes",Math.abs(i.start.diff(i.end,"minutes"))),i.start<TimeScheduler.Options.Start&&(r.add("minutes",i.start.diff(TimeScheduler.Options.Start,"minutes")),u.add("minutes",i.start.diff(TimeScheduler.Options.Start,"minutes"))),t.draggable.appendTo($(this)),t.draggable.css({left:t.helper.position().left-$(this).position().left,top:t.helper.position().top-$(this).position().top}),TimeScheduler.Options.DisableOnMove&&t.draggable.draggable("disable").resizable("disable"),t.draggable.show(),TimeScheduler.Options.Events.ItemDropped&&setTimeout(function(){TimeScheduler.Options.Events.ItemDropped.call(this,i,f,r,u)},0)}})),TimeScheduler.Options.AllowResizing){var t=null;n.find(".time-sch-item-start").length&&n.find(".time-sch-item-end").length?t="e, w":n.find(".time-sch-item-start").length?t="w":n.find(".time-sch-item-end").length&&(t="e"),t&&n.resizable({handles:t,resize:function(n,t){var i,r,u,e,o,f;TimeScheduler.Options.Events.ItemMovement&&(e=TimeScheduler.GetSelectedPeriod(),o=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,e),f=Math.abs(TimeScheduler.Options.Start.diff(o,"minutes")),i=$(this).data("item"),t.position.left!==t.originalPosition.left?(r=moment(TimeScheduler.Options.Start).add("minutes",f*($(this).position().left/TimeScheduler.SectionWrap.width())),u=i.end):(r=i.start,u=moment(TimeScheduler.Options.Start).add("minutes",f*(($(this).position().left+$(this).width())/TimeScheduler.SectionWrap.width()))),TimeScheduler.Options.Events.ItemMovement.call(this,i,r,u))},start:function(){$(this).find(".time-sch-item-event").hide(),TimeScheduler.Options.Events.ItemMovementStart&&TimeScheduler.Options.Events.ItemMovementStart.call(this)},stop:function(n,t){var i,r,u,e,o,f;e=TimeScheduler.GetSelectedPeriod(),o=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,e),f=Math.abs(TimeScheduler.Options.Start.diff(o,"minutes")),i=$(this).data("item"),t.position.left!==t.originalPosition.left?(r=moment(TimeScheduler.Options.Start).add("minutes",f*($(this).position().left/TimeScheduler.SectionWrap.width())),u=i.end):(r=i.start,u=moment(TimeScheduler.Options.Start).add("minutes",f*(($(this).position().left+$(this).width())/TimeScheduler.SectionWrap.width()))),TimeScheduler.Options.DisableOnMove&&$(this).resizable("disable").draggable("disable").find(".time-sch-item-event").show(),TimeScheduler.Options.Events.ItemMovementEnd&&TimeScheduler.Options.Events.ItemMovementEnd.call(this),TimeScheduler.Options.Events.ItemResized&&TimeScheduler.Options.Events.ItemResized.call(this,i,r,u)}})}TimeScheduler.Options.Events.ItemEventClicked&&n.find(".time-sch-item-event").click(function(n){n.preventDefault();var t=$(this).closest(".time-sch-item");n.preventDefault(),TimeScheduler.Options.Events.ItemEventClicked.call(this,$(this).data("event"),t.data("item"))}),TimeScheduler.Options.Events.ItemEventMouseEnter&&n.find(".time-sch-item-event").mouseenter(function(n){var t=$(this).closest(".time-sch-item");n.preventDefault(),TimeScheduler.Options.Events.ItemEventClicked.call(this,$(this).data("event"),t.data("item"))}),TimeScheduler.Options.Events.ItemEventMouseLeave&&n.find(".time-sch-item-event").mouseleave(function(n){var t=$(this).closest(".time-sch-item");n.preventDefault(),TimeScheduler.Options.Events.ItemEventClicked.call(this,$(this).data("event"),t.data("item"))})},FillSections:function(n){!TimeScheduler.CachedSectionResult||n?TimeScheduler.Options.GetSections.call(this,TimeScheduler.FillSections_Callback):TimeScheduler.FillSections_Callback(TimeScheduler.CachedSectionResult)},FillSections_Callback:function(n){TimeScheduler.CachedSectionResult=n,TimeScheduler.CreateSections(n),TimeScheduler.FillSchedule()},FillSchedule:function(){var n,t;n=TimeScheduler.GetSelectedPeriod(),t=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,n),TimeScheduler.Options.GetSchedule.call(this,TimeScheduler.FillSchedule_Callback,TimeScheduler.Options.Start,t)},FillSchedule_Callback:function(n){TimeScheduler.CachedScheduleResult=n,TimeScheduler.CreateItems(n)},FillHeader:function(){var t,i,n,s,r,e,o,u,f;for(i=$('<div class="time-sch-period-container"><\/div>'),n=$('<div class="time-sch-time-container"><\/div>'),t=$('<div class="time-sch-title"><\/div>'),TimeScheduler.HeaderWrap.empty().append(i,n,t),e=TimeScheduler.GetSelectedPeriod(),o=TimeScheduler.GetEndOfPeriod(TimeScheduler.Options.Start,e),t.text(TimeScheduler.Options.Start.format(TimeScheduler.Options.HeaderFormat)+" - "+o.format(TimeScheduler.Options.HeaderFormat)),f=0;f<TimeScheduler.Options.Periods.length;f++)u=TimeScheduler.Options.Periods[f],s=$('<a class="time-sch-period-button time-sch-button" href="#"><\/a>').text(u.Label).addClass(u.Name===e.Name?"time-sch-selected-button":"").data("period",u).click(TimeScheduler.Period_Clicked).appendTo(i);TimeScheduler.Options.ShowGoto&&(r=$('<a class="time-sch-time-button time-sch-time-button-goto time-sch-button" href="#"><\/a>').append(TimeScheduler.Options.Text.GotoButton).attr("title",TimeScheduler.Options.Text.GotoButtonTitle).click(TimeScheduler.GotoTimeShift_Clicked).appendTo(n)),TimeScheduler.Options.ShowToday&&(r=$('<a class="time-sch-time-button time-sch-time-button-today time-sch-button" href="#"><\/a>').append(TimeScheduler.Options.Text.TodayButton).attr("title",TimeScheduler.Options.Text.TodayButtonTitle).click(TimeScheduler.TimeShift_Clicked).appendTo(n)),r=$('<a class="time-sch-time-button time-sch-time-button-prev time-sch-button" href="#"><\/a>').append(TimeScheduler.Options.Text.PrevButton).attr("title",TimeScheduler.Options.Text.PrevButtonTitle).click(TimeScheduler.TimeShift_Clicked).appendTo(n),r=$('<a class="time-sch-time-button time-sch-time-button-next time-sch-button" href="#"><\/a>').append(TimeScheduler.Options.Text.NextButton).attr("title",TimeScheduler.Options.Text.NextButtonTitle).click(TimeScheduler.TimeShift_Clicked).appendTo(n),TimeScheduler.HeaderWrap.append(i,n,t)},GotoTimeShift_Clicked:function(n){n.preventDefault();var t=$('<input type="text" />').css({position:"absolute",left:0,bottom:0}).appendTo($(this)).datepicker({onClose:function(){$(this).remove()},onSelect:function(n){TimeScheduler.Options.Start=moment(n),TimeScheduler.Init()},defaultDate:TimeScheduler.Options.Start.toDate()});t.datepicker("show"),t.hide()},TimeShift_Clicked:function(n){var t;n.preventDefault(),t=TimeScheduler.GetSelectedPeriod(),$(this).is(".time-sch-time-button-today")?TimeScheduler.Options.Start=moment().startOf("day"):$(this).is(".time-sch-time-button-prev")?TimeScheduler.Options.Start.add("minutes",t.TimeframeOverall*-1):$(this).is(".time-sch-time-button-next")&&TimeScheduler.Options.Start.add("minutes",t.TimeframeOverall),TimeScheduler.Init()},SelectPeriod:function(n){TimeScheduler.Options.SelectedPeriod=n,TimeScheduler.Init()},Period_Clicked:function(n){n.preventDefault(),TimeScheduler.SelectPeriod($(this).data("period").Name)}};
//@ sourceMappingURL=timelineScheduler.min.js.map